(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{652:function(s,t){s.exports="https://pldq.gitee.io/assets/img/20200903193711.645ba9b0.png"},653:function(s,t){s.exports="https://pldq.gitee.io/assets/img/1599133749.11c58a41.jpg"},654:function(s,t){s.exports="https://pldq.gitee.io/assets/img/1599135971.d412f6f8.jpg"},655:function(s,t){s.exports="https://pldq.gitee.io/assets/img/20200904105913.b06f6e1c.png"},656:function(s,t){s.exports="https://pldq.gitee.io/assets/img/1599188666.82c4399b.jpg"},657:function(s,t){s.exports="https://pldq.gitee.io/assets/img/20200904142421.099ecca2.png"},658:function(s,t){s.exports="https://pldq.gitee.io/assets/img/20200904141300.4728d9ea.png"},659:function(s,t){s.exports="data:image/png;base64,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"},660:function(s,t){s.exports="https://pldq.gitee.io/assets/img/20200904135405.af478621.png"},707:function(s,t,a){"use strict";a.r(t);var n=a(9),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"版本号"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#版本号"}},[s._v("#")]),s._v(" 版本号")]),s._v(" "),n("ul",[n("li",[s._v("SpringBoot: 2.1.10.RELEASE")]),s._v(" "),n("li",[s._v("Tomcat-Embed: 9.0.27")])]),s._v(" "),n("h2",{attrs:{id:"问题现象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#问题现象"}},[s._v("#")]),s._v(" 问题现象")]),s._v(" "),n("p",[s._v("使用 Chrome 浏览器浏览页面时，每个页面加载时间非常长，通过浏览器开发者工具可以看到页面每个接口的调用时间都在 10s 左右（"),n("strong",[s._v("包括静态资源和API接口")]),s._v("）")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"接口调用明细","data-src":a(652),loading:"lazy"}})]),s._v(" "),n("h2",{attrs:{id:"排查过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#排查过程"}},[s._v("#")]),s._v(" 排查过程")]),s._v(" "),n("h3",{attrs:{id:"_1-过滤器-拦截器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-过滤器-拦截器"}},[s._v("#")]),s._v(" 1. 过滤器？拦截器？")]),s._v(" "),n("p",[s._v("由于接口调用时间大都一致，脑海中首先推断可能是代码中存在的单点验证等过滤器或拦截器造成的，如果其中逻辑存在阻塞就有可能出现该情况，并且接口调用时间就约等于阻塞时间")]),s._v(" "),n("p",[s._v("为了验证这个猜想，使用命令开启服务器端远程调试，附加到该服务进行调试，分别在执行过滤器代码前和 controller 的第一行下断点")]),s._v(" "),n("p",[s._v("远程调试参数如下：")]),s._v(" "),n("div",{staticClass:"language-shell script line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("-agentlib:jdwp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("transport"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dt_socket,server"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("y,suspend"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("n,address"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20080")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("下断点后重新调用接口，然后发现程序在两个端点之间执行的速度几乎可以忽略不计，由此可见并不是过滤器或者拦截器的问题，但是也说明了"),n("strong",[s._v("阻塞位置位于过滤器逻辑执行之前")])]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":a(653),loading:"lazy"}})]),s._v(" "),n("h3",{attrs:{id:"_2-定位阻塞位置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-定位阻塞位置"}},[s._v("#")]),s._v(" 2. 定位阻塞位置")]),s._v(" "),n("p",[s._v("不断下断点尝试后，终于定位出代码阻塞位置，位于 "),n("code",[s._v("RemoteIpValve")]),s._v(" 类中的 610 行")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("apache"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("catalina"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("valves")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("RemoteIpValve")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ValveBase")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("invoke")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Request")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Response")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ServletException")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" originalRemoteAddr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRemoteAddr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" originalRemoteHost "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRemoteHost")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" originalScheme "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getScheme")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" originalSecure "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isSecure")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" originalServerName "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServerName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" originalLocalName "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLocalName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" originalServerPort "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getServerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("final")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" originalLocalPort "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLocalPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("步入 "),n("code",[s._v("request.getLocalName()")]),s._v(" 方法，最终到达 "),n("code",[s._v("InetAddress")]),s._v(" 类中的 "),n("code",[s._v("getHostFromNameService")]),s._v(" 静态方法，它能够获取给定IP地址的主机名")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("net")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetAddress")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("Serializable")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHostFromNameService")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetAddress")]),s._v(" addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" check"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" host "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("try")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// first lookup the hostname")]),s._v("\n                host "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nameService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHostByAddr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* check to see if calling code is allowed to know\n                 * the hostname for this IP address, ie, connect to the host\n                 */")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("check"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("SecurityManager")]),s._v(" sec "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("System")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSecurityManager")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sec "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        sec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkConnect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ...省略")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("满怀着要柳暗花明的心情继续步入，却发现没那么简单...")]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("net")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Inet4AddressImpl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetAddressImpl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getLocalHostName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnknownHostException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("InetAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("lookupAllHostAddr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" hostname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnknownHostException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHostByAddr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("UnknownHostException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("native")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("boolean")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isReachable0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" timeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ifaddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" ttl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("throws")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("IOException")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("靠，"),n("code",[s._v("getHostByAddr")]),s._v(" 是一个 native 方法")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":a(654),loading:"lazy"}})]),s._v(" "),n("h3",{attrs:{id:"_3-定位-openjdk-源码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-定位-openjdk-源码"}},[s._v("#")]),s._v(" 3. 定位 OpenJdk 源码")]),s._v(" "),n("p",[s._v("前往 OpenJdk 官网下载 jdk1.8 的源码（本文暂不详细描述）")]),s._v(" "),n("p",[s._v("根据JNI官方文档可以得知，本地方法命名按照以下部分拼接得成：")]),s._v(" "),n("ul",[n("li",[n("code",[s._v("Java_")]),s._v(" 前缀")]),s._v(" "),n("li",[s._v("转义过的全限定类名（包名+类名）")]),s._v(" "),n("li",[n("code",[s._v("_")]),s._v("下划线分隔符")]),s._v(" "),n("li",[s._v("转义过的方法名")]),s._v(" "),n("li",[s._v("对于重载的本地方法，使用 "),n("code",[s._v("__")]),s._v(" 在转义过的参数签名前")])]),s._v(" "),n("p",[s._v("根据此规则，可以得知 "),n("code",[s._v("getHostByAddr")]),s._v(" 对应的本地方法名为 "),n("code",[s._v("Java_java_net_Inet4AddressImpl_getHostByAddr")])]),s._v(" "),n("p",[s._v("搜索方法名结果如下，有三个地方定义了该方法，由于测试环境是 Centos 操作系统，所以 windows 上的实现可以不看了")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":a(655),loading:"lazy"}})]),s._v(" "),n("p",[s._v("定位到 "),n("code",[s._v("jdk\\src\\solaris\\native\\java\\net\\Inet4AddressImpl.c")]),s._v(" 文件， 该文件中实现了两个 "),n("code",[s._v("Java_java_net_Inet4AddressImpl_getHostByAddr")]),s._v(" 方法，两个实现由 "),n("code",[s._v("_ALLBSD_SOURCE")]),s._v(" 和 "),n("code",[s._v("HAS_GLIBC_GETHOSTBY_R")]),s._v(" 宏定义控制")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":a(656),loading:"lazy"}})]),s._v(" "),n("p",[s._v("centos操作系统最终调用的方法如下：")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("div",{staticClass:"highlighted"},[s._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[s._v("JNIEXPORT jstring JNICALL\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Java_java_net_Inet4AddressImpl_getHostByAddr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("JNIEnv "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" jobject this"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                                            jbyteArray addrArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    jstring ret "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NI_MAXHOST"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" error "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" len "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    jbyte caddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr_in")]),s._v(" him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("sa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    jint addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetByteArrayRegion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" addrArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" caddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("caddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xff000000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("caddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xff0000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("caddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xff00")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("caddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0xff")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s_addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("htonl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_family "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_INET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    sa "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("sockaddr")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    len "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    error "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getnameinfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" len"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NI_MAXHOST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                        NI_NAMEREQD"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("error"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ret "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("NewStringUTF")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ret "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("JNU_ThrowByName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" JNU_JAVANETPKG "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"UnknownHostException"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" ret"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("p",[s._v("正道的光照在了 "),n("code",[s._v("getnameinfo")]),s._v(" 方法上")]),s._v(" "),n("h3",{attrs:{id:"确定罪魁祸首"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#确定罪魁祸首"}},[s._v("#")]),s._v(" 确定罪魁祸首")]),s._v(" "),n("p",[s._v("为了确定这个猜想，特意用c语言写了一个小程序，程序源码如下：")]),s._v(" "),n("div",{staticClass:"language-c line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("<iostream>")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("<cstring>")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sys/timeb.h"')])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[s._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"netdb.h"')])]),s._v("\n\nusing namespace std"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCurrentMillis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    timeb time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ftime")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("time "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("millitm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" start "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCurrentMillis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 此处定义要查询的ip地址")]),s._v("\n    sockaddr_in him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    sockaddr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("sa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("memset")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("s_addr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("htonl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("addr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sin_family "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" AF_INET"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    sa "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" reinterpret_cast"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("sockaddr "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("int")]),s._v(" len "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sizeof")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("him4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("char")]),s._v(" host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NI_MAXHOST "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getnameinfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sa"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" len"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NI_MAXHOST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" NI_NAMEREQD"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("long")]),s._v(" end "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getCurrentMillis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"getnameinfo = "')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" host "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    cout "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"getnameinfo cost time "')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("end "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ms"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("p",[s._v("将程序编译后放到测试环境上运行，程序运行结果如下")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":a(657),loading:"lazy"}})]),s._v(" "),n("p",[s._v("果然是 "),n("code",[s._v("getnameinfo")]),s._v(" 方法，这个方法调用一次就需要 10s")]),s._v(" "),n("h3",{attrs:{id:"深究原因"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#深究原因"}},[s._v("#")]),s._v(" 深究原因")]),s._v(" "),n("p",[s._v("搜索一圈 "),n("code",[s._v("getnameinfo")]),s._v(" 后，发现这个函数是通过向 DNS 反向查询主机名，如果 dns 反向查找找不到主机名就阻塞住")]),s._v(" "),n("p",[s._v("更多信息查看 "),n("a",{attrs:{href:"https://social.msdn.microsoft.com/Forums/windowsapps/en-US/5e8ce3a5-8c96-4205-a8ec-ba9a708b8c16/getnameinfo-very-slow?forum=windowsgeneraldevelopmentissues",target:"_blank",rel:"noopener noreferrer"}},[s._v("getnameinfo very slow!"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"解决方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),n("h3",{attrs:{id:"更换容器"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更换容器"}},[s._v("#")]),s._v(" 更换容器")]),s._v(" "),n("p",[s._v("当使用 "),n("code",[s._v("undertow")]),s._v(" 替换 "),n("code",[s._v("tomcat")]),s._v(" 时，该问题不会复现（目前使用方法），替换容器只需要在 pom 文件中引用依赖和排除掉tomcat依赖即可")]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-web"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclusions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("exclusion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-tomcat"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclusion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("exclusions")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-undertow"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("h3",{attrs:{id:"使用-hosts"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用-hosts"}},[s._v("#")]),s._v(" 使用 hosts")]),s._v(" "),n("p",[s._v("操作系统规定，在进行DNS请求以前，先检查系自己的Hosts文件中是否有这个域名和IP的映射关系。如果有，则直接访问这个IP地址指定的网络位置，如果没有，再向已知的DNS服务器提出域名解析请求。也就是说Hosts的IP解析优先级比DNS要高。")]),s._v(" "),n("p",[s._v("修改 "),n("code",[s._v("/etc/hosts")]),s._v(" 文件，将解析结果直接写死在该文件中")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":a(658),loading:"lazy"}})]),s._v(" "),n("p",[s._v("运行程序测试结果如下：")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":a(659),loading:"lazy"}})]),s._v(" "),n("h3",{attrs:{id:"干掉系统-dns"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#干掉系统-dns"}},[s._v("#")]),s._v(" 干掉系统 DNS")]),s._v(" "),n("p",[s._v("既然大部分时间阻塞在DNS反向查询上，那么干掉DNS应该解决问题了")]),s._v(" "),n("p",[s._v("编辑 "),n("code",[s._v("/etc/resolv.conf")]),s._v(" 文件，将文件内容备份并清空，再次运行程序查看")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"","data-src":a(660),loading:"lazy"}})]),s._v(" "),n("p",[s._v("每次查询只需要 1ms，这也证实了这个函数内部确实走了 dns")]),s._v(" "),n("h2",{attrs:{id:"参考文献"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考文献"}},[s._v("#")]),s._v(" 参考文献")]),s._v(" "),n("ul",[n("li",[s._v("[1] "),n("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/technotes/guides/jni/spec/design.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("JNI Chapter 2: Design Overview"),n("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);